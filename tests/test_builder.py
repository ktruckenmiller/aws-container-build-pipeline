
from mock import Mock
import os
import json
import pytest
from pprint import pprint

dynamo_event = {u'Records': [{u'eventID': u'6b0adbcaea422bb1436ec62116ee1fa1', u'eventVersion': u'1.1', u'dynamodb': {u'SequenceNumber': u'100000000000819543910', u'Keys': {u'id': {u'S': u'829af0ce-d2ea-11e6-99e6-8646f42f1c59'}}, u'SizeBytes': 6757, u'NewImage': {u'repo_id': {u'S': u'75007036'}, u'event_type': {u'S': u'git_tag'}, u'date_modified': {u'S': u'2017-01-05T01:58:53.675298Z'}, u'repo_owner': {u'S': u'ktruckenmiller'}, u'logs': {u'S': u'{"forced": false, "compare": "https://github.com/ktruckenmiller/docker-friend/compare/0.0.19", "pusher": {"name": "ktruckenmiller", "email": "kmtruckenmiller@gmail.com"}, "sender": {"following_url": "https://api.github.com/users/ktruckenmiller/following{/other_user}", "events_url": "https://api.github.com/users/ktruckenmiller/events{/privacy}", "organizations_url": "https://api.github.com/users/ktruckenmiller/orgs", "url": "https://api.github.com/users/ktruckenmiller", "gists_url": "https://api.github.com/users/ktruckenmiller/gists{/gist_id}", "html_url": "https://github.com/ktruckenmiller", "subscriptions_url": "https://api.github.com/users/ktruckenmiller/subscriptions", "avatar_url": "https://avatars.githubusercontent.com/u/1864889?v=3", "repos_url": "https://api.github.com/users/ktruckenmiller/repos", "received_events_url": "https://api.github.com/users/ktruckenmiller/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/ktruckenmiller/starred{/owner}{/repo}", "site_admin": false, "login": "ktruckenmiller", "type": "User", "id": 1864889, "followers_url": "https://api.github.com/users/ktruckenmiller/followers"}, "repository": {"issues_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/issues{/number}", "deployments_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/deployments", "stargazers_count": 0, "forks_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/forks", "mirror_url": null, "subscription_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/subscription", "notifications_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/notifications{?since,all,participating}", "collaborators_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/collaborators{/collaborator}", "updated_at": "2016-11-28T19:30:23Z", "private": false, "pulls_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/pulls{/number}", "issue_comment_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/issues/comments{/number}", "labels_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/labels{/name}", "has_wiki": true, "full_name": "ktruckenmiller/docker-friend", "owner": {"name": "ktruckenmiller", "email": "kmtruckenmiller@gmail.com"}, "statuses_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/statuses/{sha}", "id": 75007036, "keys_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/keys{/key_id}", "description": "A Docker UI that helps you manage and use containers for local development", "tags_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/tags", "downloads_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/downloads", "assignees_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/assignees{/user}", "contents_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/contents/{+path}", "has_pages": false, "git_refs_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/git/refs{/sha}", "open_issues_count": 0, "clone_url": "https://github.com/ktruckenmiller/docker-friend.git", "watchers_count": 0, "git_tags_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/git/tags{/sha}", "milestones_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/milestones{/number}", "languages_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/languages", "size": 1169, "homepage": null, "fork": false, "commits_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/commits{/sha}", "releases_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/releases{/id}", "issue_events_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/issues/events{/number}", "archive_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/{archive_format}{/ref}", "comments_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/comments{/number}", "events_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/events", "contributors_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/contributors", "html_url": "https://github.com/ktruckenmiller/docker-friend", "forks": 0, "compare_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/compare/{base}...{head}", "open_issues": 0, "git_url": "git://github.com/ktruckenmiller/docker-friend.git", "svn_url": "https://github.com/ktruckenmiller/docker-friend", "merges_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/merges", "has_issues": true, "ssh_url": "git@github.com:ktruckenmiller/docker-friend.git", "blobs_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/git/blobs{/sha}", "master_branch": "master", "git_commits_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/git/commits{/sha}", "hooks_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/hooks", "has_downloads": true, "watchers": 0, "name": "docker-friend", "language": "JavaScript", "url": "https://github.com/ktruckenmiller/docker-friend", "stargazers": 0, "created_at": 1480361376, "pushed_at": 1483581530, "forks_count": 0, "default_branch": "master", "teams_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/teams", "trees_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/git/trees{/sha}", "branches_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/branches{/branch}", "subscribers_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/subscribers", "stargazers_url": "https://api.github.com/repos/ktruckenmiller/docker-friend/stargazers"}, "created": true, "deleted": false, "commits": [], "after": "04741908d481043714d3047c2182aab752b2affc", "head_commit": {"committer": {"name": "Kevin Truckenmiller", "email": "kevintruckenmiller@Kevins-MacBook-Pro.local"}, "added": [], "author": {"name": "Kevin Truckenmiller", "email": "kevintruckenmiller@Kevins-MacBook-Pro.local"}, "distinct": true, "timestamp": "2017-01-04T19:58:32-06:00", "modified": ["README.md", "app/public/js/script.js", "docker-friend.png", "lib/script.js"], "url": "https://github.com/ktruckenmiller/docker-friend/commit/04741908d481043714d3047c2182aab752b2affc", "tree_id": "2abb986a9aa3499da13e5ac91b43170bfa95b25f", "message": "merge", "removed": [], "id": "04741908d481043714d3047c2182aab752b2affc"}, "ref": "refs/tags/0.0.19", "base_ref": "refs/heads/master", "before": "0000000000000000000000000000000000000000"}'}, u'sha': {u'S': u'04741908d481043714d3047c2182aab752b2affc'}, u'tag': {u'S': u'0.0.19'}, u'date_created': {u'S': u'2017-01-05T01:58:53.675285Z'}, u'id': {u'S': u'829af0ce-d2ea-11e6-99e6-8646f42f1c59'}, u'repo_name': {u'S': u'docker-friend'}}, u'ApproximateCreationDateTime': 1483581480.0, u'StreamViewType': u'NEW_IMAGE'}, u'awsRegion': u'us-west-2', u'eventName': u'INSERT', u'eventSourceARN': u'arn:aws:dynamodb:us-west-2:601394826940:table/events-table-EventDb-VBTRJR26RPRS/stream/2017-01-05T01:41:53.755', u'eventSource': u'aws:dynamodb'}]}



def open_file(filename):
    with open("testdata/"+filename, 'r') as f:
        read_data = f.read()
        return read_data

def test_main_func(monkeypatch):
    monkeypatch.setenv('AWS_DEFAULT_REGION', "us-west-2")
    monkeypatch.setenv('TABLE_NAME', 'events-table-EventDb-VBTRJR26RPRS')
    from builder import build
    build.lambda_handler(dynamo_event, {})
